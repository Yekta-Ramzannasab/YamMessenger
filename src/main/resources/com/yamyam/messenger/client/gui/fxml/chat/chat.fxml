<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.*?>

<!-- Root as StackPane so we can show an overlay (folders drawer) above the main layout -->
<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.yamyam.messenger.client.gui.controller.chat.ChatController"
           stylesheets="@/com/yamyam/messenger/client/gui/styles/chat.css"
           styleClass="themed chat-root"
           prefWidth="1120" prefHeight="720">

    <!-- Main layout (BorderPane from develop, kept intact) -->
    <BorderPane fx:id="mainLayout">

        <!-- define ToggleGroup once -->
        <fx:define>
            <ToggleGroup fx:id="themeGroup"/>
        </fx:define>

        <left>
            <VBox spacing="12" prefWidth="320" styleClass="chat-sidebar">
                <HBox alignment="CENTER_LEFT" spacing="10" styleClass="chat-sidebar__header">
                    <Button fx:id="btnHamburger" text="≡" onAction="#openFoldersManager" styleClass="hamburger-btn"/>
                    <Label text="Yam" styleClass="chat-brand"/>
                </HBox>

                <TextField fx:id="searchField" promptText="Search..." maxWidth="Infinity" styleClass="chat-search"/>

                <!-- Exactly one viewport: we swap between the two lists -->
                <StackPane VBox.vgrow="ALWAYS">
                    <ListView fx:id="chatList"/>                                  <!-- default visible -->
                    <ListView fx:id="searchResults" visible="false" managed="false"/> <!-- shown only when searching -->
                </StackPane>
            </VBox>

        </left>

        <center>
            <BorderPane styleClass="chat-conv">
                <top>
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="chat-conv__header">
                        <ImageView fx:id="headerAvatar" fitWidth="36" fitHeight="36" preserveRatio="true"/>
                        <VBox>
                            <Label fx:id="headerName"   styleClass="chat-conv__name"   text="Select a chat"/>
                            <Label fx:id="headerStatus" styleClass="chat-conv__status" text=""/>
                        </VBox>
                        <Pane HBox.hgrow="ALWAYS"/>

                        <!-- theme button -->
                        <MenuButton fx:id="themeBtn"
                                    text="Theme"
                                    styleClass="chat-iconbtn theme-picker"
                                    onMouseClicked="#cycleTheme">
                            <items>
                                <RadioMenuItem fx:id="miLight"  text="Light"
                                               toggleGroup="$themeGroup"
                                               onAction="#setThemeLight"/>
                                <RadioMenuItem fx:id="miDark"   text="Dark"
                                               toggleGroup="$themeGroup"
                                               onAction="#setThemeDark"/>
                                <RadioMenuItem fx:id="miAmoled" text="AMOLED"
                                               toggleGroup="$themeGroup"
                                               onAction="#setThemeAmoled"/>
                            </items>
                        </MenuButton>
                    </HBox>
                </top>

                <center>
                    <ListView fx:id="messageList"/>
                </center>

                <bottom>
                    <HBox spacing="10" alignment="CENTER" styleClass="chat-composer">
                        <Button text="☺" styleClass="chat-iconbtn"/>
                        <TextArea fx:id="inputField" promptText="Write a message" wrapText="true"
                                  prefRowCount="1" HBox.hgrow="ALWAYS"/>
                        <Button fx:id="sendBtn" text="➤" onAction="#sendMessage" styleClass="chat-send" disable="true"/>
                    </HBox>
                </bottom>
            </BorderPane>
        </center>

        <!-- Keep the full develop info pane so existing controller code won't break -->
        <right>
            <VBox fx:id="infoPane" spacing="12" prefWidth="300" styleClass="chat-info" visible="true" managed="true">
                <ImageView fx:id="infoAvatar" fitWidth="96" fitHeight="96" preserveRatio="true"/>
                <Label fx:id="infoName"     styleClass="chat-info__name"/>
                <Label fx:id="infoBio"      styleClass="chat-info__bio"/>
                <Label fx:id="infoUsername" styleClass="chat-info__username"/>
                <Label fx:id="infoEmail"    styleClass="chat-info__email"/>
                <Label fx:id="infoPresence" styleClass="chat-info__presence"/>
                <Separator/>
                <Label text="Media" styleClass="chat-section"/>
                <FlowPane fx:id="mediaGrid" hgap="8" vgap="8"/>
            </VBox>
        </right>

    </BorderPane>

    <!-- ===== Overlay: Folders Drawer (initially hidden) ===== -->
    <StackPane fx:id="foldersOverlay" visible="false" managed="false" pickOnBounds="true" styleClass="overlay-root">
        <!-- dark scrim -->
        <Pane fx:id="overlayScrim" onMouseClicked="#closeFoldersDrawer" styleClass="overlay-scrim"/>
        <!-- sliding drawer -->
        <VBox fx:id="foldersDrawer" spacing="12" maxWidth="360" prefWidth="360"
              StackPane.alignment="CENTER_LEFT" styleClass="overlay-drawer">

            <HBox alignment="CENTER_LEFT" spacing="8" styleClass="drawer__header">
                <Label text="Folders" styleClass="drawer__title"/>
                <Pane HBox.hgrow="ALWAYS"/>
                <Button text="✕" onAction="#closeFoldersDrawer" styleClass="drawer__close"/>
            </HBox>

            <Label text="My folders" styleClass="drawer__subtitle"/>

            <ListView fx:id="foldersList" VBox.vgrow="ALWAYS"/>

            <Button fx:id="btnCreateFolder" text="Create new folder"
                    onAction="#openCreateFolderDialog" styleClass="drawer__create"/>
        </VBox>
    </StackPane>
</StackPane>
