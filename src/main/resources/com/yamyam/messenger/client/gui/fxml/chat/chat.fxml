<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.geometry.*?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.yamyam.messenger.client.gui.controller.chat.ChatController"
           stylesheets="@/com/yamyam/messenger/client/gui/styles/chat.css"
           fx:id="rootPane"
           prefWidth="1120" prefHeight="720">

    <!-- Main Chat Page -->
    <BorderPane fx:id="mainChatUI"
                styleClass="themed chat-root"
                prefWidth="1120" prefHeight="720">

        <fx:define>
            <ToggleGroup fx:id="themeGroup"/>
        </fx:define>

        <!-- LEFT: Sidebar -->
        <left>
            <VBox spacing="12" prefWidth="320" styleClass="chat-sidebar">
                <!-- Sidebar header: hamburger (left) + brand -->
                <HBox alignment="CENTER_LEFT" spacing="10" styleClass="chat-sidebar__header">
                    <!-- hamburger first -->
                    <Button fx:id="menuTriggerBtn"
                            text="☰"
                            styleClass="chat-menu-trigger"
                            onAction="#toggleMenuOverlay">
                        <tooltip>
                            <Tooltip text="Menu"/>
                        </tooltip>
                    </Button>

                    <!-- brand second -->
                    <Label text="Yam" styleClass="chat-brand"/>
                </HBox>



                <TextField fx:id="searchField" promptText="Search..." maxWidth="Infinity" styleClass="chat-search"/>
                <ListView fx:id="searchResults" VBox.vgrow="ALWAYS"/>
            </VBox>
        </left>

        <!-- CENTER: Conversation -->
        <center>
            <BorderPane styleClass="chat-conv">
                <top>
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="chat-conv__header">
                        <ImageView fx:id="headerAvatar" fitWidth="36" fitHeight="36" preserveRatio="true"/>
                        <VBox>
                            <Label fx:id="headerName"   styleClass="chat-conv__name"   text="Select a chat"/>
                            <Label fx:id="headerStatus" styleClass="chat-conv__status" text=""/>
                        </VBox>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <!-- Legacy theme button kept hidden for backward-compatibility -->
                        <MenuButton fx:id="themeBtn"
                                    text="Theme"
                                    styleClass="chat-iconbtn theme-picker"
                                    onMouseClicked="#cycleTheme"
                                    visible="false" managed="false">
                            <items>
                                <RadioMenuItem fx:id="miLight"  text="Light"  toggleGroup="$themeGroup" onAction="#setThemeLight"/>
                                <RadioMenuItem fx:id="miDark"   text="Dark"   toggleGroup="$themeGroup" onAction="#setThemeDark"/>
                                <RadioMenuItem fx:id="miAmoled" text="AMOLED" toggleGroup="$themeGroup" onAction="#setThemeAmoled"/>
                            </items>
                        </MenuButton>
                    </HBox>
                </top>

                <center>
                    <ListView fx:id="messageList"/>
                </center>

                <bottom>
                    <HBox spacing="10" alignment="CENTER" styleClass="chat-composer">
                        <Button text="☺" styleClass="chat-iconbtn"/>
                        <TextArea fx:id="inputField" promptText="Write a message" wrapText="true"
                                  prefRowCount="1" HBox.hgrow="ALWAYS"/>
                        <Button fx:id="sendBtn" text="➤" onAction="#sendMessage" styleClass="chat-send" disable="true"/>
                    </HBox>
                </bottom>
            </BorderPane>
        </center>

        <!-- RIGHT: Info pane -->
        <right>
            <VBox fx:id="infoPane" spacing="12" prefWidth="300" styleClass="chat-info" visible="true" managed="true">
                <!-- Old container that used to hold the menu button on the right.
                     Keep it hidden & unmanaged to avoid layout shifts and id collisions. -->
                <HBox alignment="TOP_RIGHT" visible="false" managed="false">
                    <Pane HBox.hgrow="ALWAYS"/>
                </HBox>

                <ImageView fx:id="infoAvatar" fitWidth="96" fitHeight="96" preserveRatio="true"/>
                <Label fx:id="infoName"     styleClass="chat-info__name"/>
                <Label fx:id="infoBio"      styleClass="chat-info__bio"/>
                <Label fx:id="infoUsername" styleClass="chat-info__username"/>
                <Label fx:id="infoEmail"    styleClass="chat-info__email"/>
                <Label fx:id="infoPresence" styleClass="chat-info__presence"/>
                <Separator/>
                <Label text="Media" styleClass="chat-section"/>
                <FlowPane fx:id="mediaGrid" hgap="8" vgap="8"/>
            </VBox>
        </right>
    </BorderPane>

    <!-- Scrim to disable the page while overlays are shown -->
    <Rectangle fx:id="scrim"
               fill="rgba(0,0,0,0.4)"
               visible="false" managed="false"
               StackPane.alignment="CENTER"
               mouseTransparent="false"
               width="1120" height="720"/>

    <!-- Primary menu overlay -->
    <StackPane fx:id="menuOverlay"
               styleClass="menu-overlay"
               visible="false" managed="false"
               maxWidth="280" maxHeight="260"
               StackPane.alignment="CENTER">

        <VBox spacing="10" alignment="TOP_CENTER" styleClass="menu-content">
            <HBox alignment="TOP_RIGHT">
                <Pane HBox.hgrow="ALWAYS"/>
                <Button fx:id="closeBtn"
                        text="✕"
                        onAction="#closeAllOverlays"
                        styleClass="menu-close-btn"/>
            </HBox>

            <Label text="My Profile"      onMouseClicked="#openSettings"/>
            <Label text="Themes"          onMouseClicked="#openSettings"/>
            <Label text="Create Channel"  onMouseClicked="#openCreateChannel"/>
            <Label text="Create Group"    onMouseClicked="#openCreateGroup"/>
            <Label text="Contacts"        onMouseClicked="#openContacts"/>
            <Label text="Saved Messages"/>
            <Label text="Settings"        onMouseClicked="#openSettings"/>
        </VBox>
    </StackPane>

    <!-- Secondary subpage overlay -->
    <StackPane fx:id="subPageOverlay"
               styleClass="subpage-overlay"
               visible="false" managed="false"
               maxWidth="360" maxHeight="400"
               StackPane.alignment="CENTER">

        <VBox spacing="10" alignment="TOP_CENTER" fx:id="subPageContent">
            <!-- Top bar: Back (left) + Close (right) -->
            <HBox alignment="CENTER" spacing="8">
                <Button text="Back" onAction="#backToMenu" styleClass="menu-back-btn"/>
                <Pane HBox.hgrow="ALWAYS"/>
                <Button text="✕" onAction="#closeAllOverlays" styleClass="menu-close-btn"/>
            </HBox>

            <!-- Dynamic subpage title -->
            <Label fx:id="subPageTitle" styleClass="subpage-title"/>

            <!-- Dynamic subpage body will be injected here by ChatController -->
        </VBox>
    </StackPane>
</StackPane>
